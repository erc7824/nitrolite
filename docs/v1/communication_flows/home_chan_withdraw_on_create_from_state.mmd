sequenceDiagram
        actor User
        actor Client
        actor Node
        actor HomeChain
        Note over Client: Connected to Node
        Note over Node: Contains a state with no channel
        User->>Client: withdraw(blockchainId, asset, amount)
        Client->>Node: GetLastState(UserWallet, asset)
        Note right of Node: GetLastState(userWallet, asset)
        Node->>Client: Returns a state with no home chain
        %% Note over Client: Check current state transitions
        Note over Client: newChannelDefinition()
        Note over Client: createNextState(currentState) returns state
        Note over Client: state.setID(CalculateStateID(state.userWallet, state.asset, cycleId, state.version))
        Note over Client: GetTokenAddress(blockchainId, asset)
        Note over Client: state.setHomeToken(blockchainId, tokenAddress)
        Note over Client: NewTransition(withdrawalT, state.ID(), userWallet, amount)
        Note over Client: state.applyTransitions(transtions) returns true
        Note over Client: signState(state) returns userSig
        Client->>Node: RequestCreateChannel(channelDef, state, userSig)
        Note right of Node: GetLastState(userWallet, asset) returns pendingState
        Note right of Node: ValidateChannelDefinition(channelDef)
        Note right of Node: ValidateStateTransition(pendingState, state)
        Note right of Node: StoreChannel(channel)
        Note right of Node: StoreState(state)
        Node->>Client: Return node signature
        Note over Client: GetChannelId(channelDef)
        Note over Client: PackChannelDefinition(channelDef)
        Note over Client: PackState(channelId, state)
        Client->>HomeChain: createHomeChannel(packedChannelDef, packedState)
        HomeChain->>Client: Return Tx Hash
        HomeChain-->>Node: Emits HomeChannelCreated Event
        Note right of Node: HandleHomeChannelCreated()
        Note right of Node: UpdateChannel(channel)
        Node-->>Client: Sends ChannelUpdate & BalanceUpdate
        Client-->>User: Returns success
        